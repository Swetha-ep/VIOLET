{% load static%}
<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Yoga Studio Template" />
    <meta name="keywords" content="Yoga, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Violet | Template</title>

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link
      rel="stylesheet"
      href="{% static 'css/bootstrap.min.css' %}"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="{% static 'css/font-awesome.min.css' %}"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="{% static 'css/nice-select.css' %}"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="{% static 'css/owl.carousel.min.css' %}"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="{% static 'css/magnific-popup.css' %}"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="{% static 'css/slicknav.min.css' %}"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="{% static 'css/style.css' %}"
      type="text/css"
    />
    <style>
      .checkoutform label {
        font-size: 14px !important;
        font-weight: 600;
      }
      .checkoutform input {
        font-size: 14px !important;
      }
    </style>
  </head>

  <body>
    <!-- Page Preloder -->

    <!-- Search model -->
    <header class="header-section">
      <div class="container-fluid">
          <div class="inner-header">
              <div class="logo">
                  <a href="{% url 'index' %}"><img src="{% static 'img/logo.png'%}" alt=""></a>
              </div>
              <div class="header-right">
                  <a style="color:black;"href="{% url 'wishlist' %}">
                      <i class="fa fa-heart"></i>  
                  </a>
                  <a href="{% url 'user_profile'%}">
                      <img src="{% static 'img/icons/man.png'%}" alt="">
                  </a>    
                  <a class="active" href="{% url 'cart' %}">
                      <img src="{% static 'img/icons/bag.png'%}" alt="">
                      
                  </a>
              </div>
              <div class="user-access">
                  {%if user.is_authenticated %}
                      <a href="{% url 'logout' %}">Logout</a>
                  {%else%}
                      <a href="{% url 'register' %}">Register</a>
                      <a href="{% url 'loginn' %}" class="in">Sign in</a>
                  {%endif%}
              </div>
              <nav class="main-menu mobile-menu">
                  <ul>
                      <li><a  href="{% url 'index'%}">Home</a></li>
                      <li><a class="active" href="{%url 'shop'%}">Shop</a></li>
                      <li><a href="{% url 'myorders' %}">Orders</a></li>
                      <li><a href="{% url 'index'%}">Blog</a></li>
                      <li><a href="{% url 'index'%}">Contact</a></li>
                  </ul>
              </nav>
          </div>
      </div>
  </header>

    <section class="page-add">
      <div class="container">
        <div class="row">
          <div class="col-lg-4">
            <div class="page-breadcrumb">
              <h2>Checkout<span>.</span></h2>
            </div>
          </div>
          <div class="col-lg-8">
            <img src="img/add.jpg" alt="" />
          </div>
        </div>
      </div>
    </section>
    <!-- Page Add Section End -->

    <!-- Cart Total Page Begin -->
    <div class="container mt-3">
      <form action="{% url 'placeorder' %}" method="POST">
        {% csrf_token %}
        <div class="row">
          <div class="col-md-7">
            <div class="card shadow">
              <div class="card-body">
                <h6>Basic Details</h6>
                <hr />
                <div class="row checkoutform">
                  <div class="col-md-6">
                    <label>First Name</label>
                    <input
                      type="text"
                      required
                      class="form-control"
                      value="{{ userprofile.fname}}"
                      name="fname"
                      placeholder="Enter Firstname"
                    />
                  </div>
                  <div class="col-md-6">
                    <label>Last Name</label>
                    <input
                      type="text"
                      required
                      class="form-control"
                      value="{{ userprofile.lname}}"
                      name="lname"
                      placeholder=" Enter Lastname"
                    />
                  </div>
                  <div class="col-md-6 mt-2">
                    <label>Email</label>
                    <input
                      type="email"
                      required
                      class="form-control"
                      name="email"
                      value="{{ request.user.email}}"
                      placeholder="Enter Email"
                    />
                  </div>
                  <div class="col-md-6 mt-2">
                    <label>Phone</label>
                    <input
                      type="text"
                      required
                      class="form-control"
                      name="phone"
                      value="{{ userprofile.phone}}"
                      placeholder="Enter Phone"
                    />
                  </div>
                  <div class="col-md-12 mt-2">
                    <label>Address</label>
                    <textarea
                      required
                      class="form-control"
                      name="address"
                      placeholder="Enter Address"
                    >
{{ userprofile.address}}</textarea
                    >
                  </div>
                  <div class="col-md-6 mt-2">
                    <label>City</label>
                    <input
                      type="text"
                      required
                      class="form-control"
                      name="city"
                      value="{{ userprofile.city}}"
                      placeholder="Enter City"
                    />
                  </div>
                  <div class="col-md-6 mt-2">
                    <label>State</label>
                    <input
                      type="text"
                      required
                      class="form-control"
                      name="state"
                      value="{{ userprofile.state}}"
                      placeholder="Enter State"
                    />
                  </div>
                  <div class="col-md-6 mt-2">
                    <label>Country</label>
                    <input
                      type="text"
                      required
                      class="form-control"
                      name="country"
                      value="{{ userprofile.country}}"
                      placeholder="Enter Country"
                    />
                  </div>
                  <div class="col-md-6 mt-2">
                    <label>Pin Code</label>
                    <input
                      type="text"
                      required
                      class="form-control"
                      name="pincode"
                      value="{{ userprofile.pincode}}"
                      placeholder="Enter Pin Code"
                    />
                  </div>
                </div>
              </div>
            </div>

            <br />
          </div>
          <div class="col-md-5">
            <div class="card shadow">
              <div class="card-body">
                <h6>Order Summary</h6>
                <hr />
                {% if cartitems %}
                <table class="table table-stripeds table-bordereds">
                  <thead>
                    <tr>
                      <th>Product</th>
                      <th>Qty</th>
                      <th>Price</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in cartitems %}
                    <tr>
                      <td>
                        <img
                          src="{{item.product.product_image.url}}"
                          height="50px"
                          class="me-2"
                          width="50px"
                        />
                        {{item.product.product_name}}
                      </td>
                      <td>{{item.product_qty}}</td>
                      <td>
                        {% if item.product.offer %}
                            <span class="fw-bold">{{item.product.offer.offer_name}}</span>
                            <del class="text-danger ">Rs.{{item.product.selling_price | stringformat:'d'}}</del>&nbsp;
                            Rs.{{item.product.get_offer}} 
                        {% else %}
                            Rs.{{item.product.selling_price | stringformat:'d'}} 
                        {% endif %}
                      </td>
                    </tr>
                    
                  </tbody>
                </table>

                <hr />
                {% if item.product.offer %}
                  <h6 class="fw-bold">
                    Discount :<p style="color:black;"class="float-right text-danger" >-{{item.product.offer.discount}}</p>
                  </h6>
                  <hr>
                {% endif %}
                {% comment %} <br> {% endcomment %}
                <h6 class="fw-bold">
                  Grand Total :

                  <span class="float-right"
                    >Rs.{{ totalprice | stringformat:'d'}}</span
                  >
                </h6>
                    
                    {% if new_price %}
                      <h6 class="fw-bold">
                        Discount :<p style="color:black;"class="float-right"></p>

                        <span class="float-right" id="coupon_discounts" style ="color:black;"></span>
                        
                      </h6>
                      <h6 class="fw-bold">
                        Total :

                        <span class="float-right" id="new_tot" style ="color:black;"></span>
                      
                      </h6>
                    {% endif %}
                  {% endfor %}
                <input type="hidden" value="COD" name="payment_mode" />
                <div class="mt-3">
                  <button
                    id="place-order-btn"
                    type="submit"
                    class="btn btn-dark w-100"
                  >
                    COD|Place Order
                  </button>
                  <br />
                  <button
                    id="place-order-btn"
                    type="button"
                    class="btn btn-outline-secondary paywithRazorPay w-100"
                  >
                    Pay with RazorPay
                  </button>
                  <div id="paypal-button-container"></div>
                </div>
                {% else %}
                <h4>Your cart is empty</h4>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </form>
      <form method="POST">
        {% csrf_token %}
        <div class="form-group">
          <label>Have coupon?</label>
          <div class="input-group">
            <input
              id="coupon_code"
              type="text"
              class="form-control coupon"
              name="coupon"
              placeholder="Coupon code"
            />
            <span class="input-group-append">
              <button
                type="submit"
                id="apply_coupon"
                class="btn btn-secondary btn-apply coupon"
              >
                Apply
              </button>
            </span>
          </div>
        </div>
        <input
          id="order_total"
          type="hidden"
          value="{{ totalprice | stringformat:'d'}}"
        />
      </form>
    </div>
    <br />
    <footer class="footer-section spad">
      <div class="container">
          
          <div class="footer-widget">
              <div class="row">
                  <div class="col-lg-3 col-sm-6">
                      <div class="single-footer-widget">
                          <img style="width:80%;" src="{% static 'img/logo.png'%}">
                          <ul>
                              
                              <li>Unleash your inner fashionista, browse and buy.</li>
                              
                          </ul>
                      </div>
                  </div>
                  <div class="col-lg-3 col-sm-6">
                      <div class="single-footer-widget">
                          <h4>HELP</h4>
                          <ul>
                              <li>Contact Us</li>
                              <li>Payment methods</li>
                              <li>Delivery</li>
                              <li>Returns and Exchanges</li>
                              
                          </ul>
                      </div>
                  </div>
                  <div class="col-lg-3 col-sm-6">
                      <div class="single-footer-widget">
                          <h4>ABOUT</h4>
                          <ul>
                              <li>About Violet</li>
                              <li>Careers</li>
                              <li>Privacy Commitment</li>
                              
                          </ul>
                      </div>
                  </div>
                  <div class="col-lg-3 col-sm-6">
                      <div class="single-footer-widget">
                          <h4>CONTACT US</h4>
                          <ul>
                              <li>email : violet.store.she@gmail.com</li>
                              <li>phno. : 91-91XXXXXXXX</li>
                              <li>phno. : 91-62XXXXXXXX</li>
                              
                          </ul>

                      </div>
                  </div>
                  
              </div>
              
          </div>
      </div>
      
          

          <div class="container text-center pt-5">
              <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
              Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved 
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          </div>


     
  </footer>
    <script src="{% static 'js/jquery-3.3.1.min.js'%}"></script>
    <script src="{% static 'js/bootstrap.min.js'%}"></script>
    <script src="{% static 'js/jquery.magnific-popup.min.js'%}"></script>
    <script src="{% static 'js/jquery.slicknav.js'%}"></script>
    <script src="{% static 'js/owl.carousel.min.js'%}"></script>
    <script src="{% static 'js/jquery.nice-select.min.js'%}"></script>
    <script src="{% static 'js/mixitup.min.js'%}"></script>
    <script src="{% static 'js/main.js'%}"></script>

    <script>
      $(document).ready(function () {
        $("#place-order-btn").click(function () {
          $.ajax({
            url: "/place-order",
            method: "POST",
            success: function (response) {
              swal(
                "Success!",
                "Your order has been placed successfully.",
                "success"
              );
            },
          });
        });
      });
    </script>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script src="{% static 'js/checkout.js'%}"></script>

    <script src="https://www.paypal.com/sdk/js?client-id=AdlgZ60xYcb0wnOcfNyGSLTCAKmABBbmcEN-_4aBNWE-mJ2eQDWVEh0kvDhqT7QosXzs0YIAldHfDUb8&currency=USD"></script>
    <script>
      paypal
        .Buttons({
          // Order is created on the server and the order id is returned
          createOrder: (data, actions) => {
            return fetch("/api/orders", {
              method: "post",
              // use the "body" param to optionally pass additional order information
              // like product skus and quantities
            })
              .then((response) => response.json())
              .then((order) => order.id);
          },
          // Finalize the transaction on the server after payer approval
          onApprove: (data, actions) => {
            return fetch(`/api/orders/${data.orderID}/capture`, {
              method: "post",
            })
              .then((response) => response.json())
              .then((orderData) => {
                // Successful capture! For dev/demo purposes:
                console.log(
                  "Capture result",
                  orderData,
                  JSON.stringify(orderData, null, 2)
                );
                const transaction =
                  orderData.purchase_units[0].payments.captures[0];
                alert(
                  `Transaction ${transaction.status}: ${transaction.id}\n\nSee console for all available details`
                );
                // When ready to go live, remove the alert and show a success message within this page. For example:
                // const element = document.getElementById('paypal-button-container');
                // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                // Or go to another URL:  actions.redirect('thank_you.html');
              });
          },
        })
        .render("#paypal-button-container");
    </script>

    <!-- Coupon Apply Start -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <script>
      $(document).ready(function () {
        $(document).on("click", "#apply_coupon", function (e) {
          e.preventDefault();
          var coupon_code = document.getElementById("coupon_code").value;
          var order_total = document.getElementById("order_total").value;
          console.log(coupon_code, "sweetha");

          $.ajax({
            method: "POST",
            url: "{% url 'apply_coupon' %}",

            data: {
              coupon_code: coupon_code,
              order_total: order_total,
              csrfmiddlewaretoken: "{{csrf_token}}",
            },

            success: function (response) {
              console.log(response);
              alertify.error(response.status);
              if (response.status === 'Coupon already used..') {
                swal("Error!.", response.status, "error")
              }else if (response.status === 'Coupon Applied..!!') {
                swal("Congratulations!.", response.status, "success")
              }else if(response.status === 'You can not use this coupon..') {
                swal("Error!.", response.status, "error")
              }else{
                swal("Error!.", "Coupon does not exist..", "error" )
              }
              
              console.log("Updating elements");
              document.getElementById("new_tot").innerHTML = "Discounted Price: Rs." + response.new_total;
              console.log(response.new_total)
              document.getElementById("new_price").value = response.new_price;
              document.getElementById("coupon_code2").value = response.coupon_code;
              document.getElementById("coupon_discounts").innerHTML = "Coupon Discount: Rs." + response.coupon_discount;
              // $('.subtotal').load(location.href + " .subtotal");
            },
          });
        });
      });
    </script>
    <!-- Coupon Apply End  -->
  </body>
</html>
